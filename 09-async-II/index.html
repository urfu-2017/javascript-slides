<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="https://yandex.ru/blog/i/ru/yablogs-favicon.ico">

    <title>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å. –ß–∞—Å—Ç—å II</title>

    <meta name="description" content="–ü—Ä–∏–µ–º—ã —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å—é">
    <meta name="author" content="–°–µ—Ä–≥–µ–π –ñ–∏–≥–∞–ª–æ–≤">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">
    <link rel="stylesheet" href="css/user.css">

	<link rel="stylesheet" href="css/tomorrow.css">
</head>
<body>
<div class="reveal"><div class="slides">

<section>
    <h1>–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å. –ß–∞—Å—Ç—å II</h1>
    <h2>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
    <p class="author">–°–µ—Ä–≥–µ–π –ñ–∏–≥–∞–ª–æ–≤</p>
</section>

<section>
    <section>
        <h2>–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</h2>
    </section>

    <section>
        <blockquote cite="https://github.com/azat-io/you-dont-know-js-ru/blob/master/async%20%26%20performance/ch1.md#event-loop">
            –í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏, –ª—é–±–æ–π —É—á–∞—Å—Ç–æ–∫ –∫–æ–¥–∞
            –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–º –ø–æ—Ç–æ–∫–µ.
        </blockquote>
    </section>

    <section>
        <h3>Run-to-Completion</h3>
        <pre class="js"><code data-trim>
let counter = 0;

counter++;

console.log(counter); // 1
        </code></pre>
    </section>

    <section>
        <h3>Now & Later</h3>
        <pre class="js"><code data-trim>
console.log('–Ø –≤—ã–ø–æ–ª–Ω—è—é—Å—å —Å–µ–π—á–∞—Å');

setTimeout(() => {
    console.log('–Ø –≤—ã–ø–æ–ª–Ω—é—Å—å –ø–æ–∑–∂–µ');
}, 5000);

console.log('–Ø —Ç–æ–∂–µ –≤—ã–ø–æ–ª–Ω—è—é—Å—å —Å–µ–π—á–∞—Å');
        </code></pre>
    </section>

    <section>
        <h3>Now ...</h3>
        <pre class="js"><code data-trim data-noescape>
<mark>console.log('–Ø –≤—ã–ø–æ–ª–Ω—è—é—Å—å —Å–µ–π—á–∞—Å');</mark>

<mark>setTimeout(() => {</mark>
    console.log('–Ø –≤—ã–ø–æ–ª–Ω—é—Å—å –ø–æ–∑–∂–µ');
<mark>}, 5000);</mark>

<mark>console.log('–Ø —Ç–æ–∂–µ –≤—ã–ø–æ–ª–Ω—è—é—Å—å —Å–µ–π—á–∞—Å');</mark>
        </code></pre>
    </section>

    <section>
        <h3>... & Later</h3>
        <pre class="js"><code data-trim data-noescape>
console.log('–Ø –≤—ã–ø–æ–ª–Ω—è—é—Å—å —Å–µ–π—á–∞—Å');

setTimeout(() => {
    <mark>console.log('–Ø –≤—ã–ø–æ–ª–Ω—é—Å—å –ø–æ–∑–∂–µ');</mark>
}, 5000);

console.log('–Ø —Ç–æ–∂–µ –≤—ã–ø–æ–ª–Ω—è—é—Å—å —Å–µ–π—á–∞—Å');
        </code></pre>
    </section>

    <section>
        <h3>Event Loop</h3>
        <pre class="js"><code data-trim>
const eventLoop = [];

while (true) {
    if (eventLoop.length > 0) {
        const event = eventLoop.shift();

        event();
    }
}
        </code></pre>
    </section>
</section>

<section>
    <section>
        <h2>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
        <ul>
            <li class="fragment">callback</li>
            <li class="fragment">promises</li>
            <li class="fragment">async await</li>
        </ul>
    </section>
</section>

<section>
    <section>
        <h2>callback</h2>
    </section>

    <section>
        <blockquote cite="https://github.com/azat-io/you-dont-know-js-ru/blob/master/async%20%26%20performance/ch1.md#event-loop">
            Hey, I'm going to suspend execution for now,
            but whenever you finish with that network request,
            and you have some data, please <b>call</b> this function <b>back.</b>"
        </blockquote>
    </section>

    <section>
        <h3>–ü—Ä–∏–º–µ—Ä</h3>
        <pre class="js"><code data-trim data-noescape>
setTimeout(<span class="fragment">() => {
    console.log('–Ø –≤—ã–ø–æ–ª–Ω—é—Å—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥');
}</span>, 5000);
        </code></pre>
    </section>

    <section>
        <h3>–ê—Ä–≥—É–º–µ–Ω—Ç—ã</h3>
        <pre class="js"><code data-trim data-noescape>
const cb = (<span class="fragment" data-fragment-index="1">error</span>, <span class="fragment" data-fragment-index="2">data</span>) => {
    <span class="fragment" data-fragment-index="1">if(error) {
        console.error(error);
    }</span><span class="fragment" data-fragment-index="2"> else {
        console.log(data);
    }</span>
}
        </code></pre>
    </section>

    <section>
        <h3>–ù–µ–ª–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥</h3>
        <pre class="js"><code data-trim>
console.log('A');

setTimeout(() => {
    console.log('B');

    setTimeout(() => console.log('C'));

    console.log('D');
});

console.log('E');
        </code></pre>
        <div class="fragment">
A ‚Üí E ‚Üí B ‚Üí D ‚Üí C
        </div>
    </section>

    <section>
        <h3>callback hell</h3>
        <pre class="js size-XS"><code data-trim data-noescape>
<span class="fragment" data-fragment-index="1">setTimeout(() => {</span>
<span class="fragment" data-fragment-index="2">    fs.readFile('./path.json', (err, data) => {</span>
<span class="fragment" data-fragment-index="3">        request(data.url, (err, res, body) => {</span>
<span class="fragment" data-fragment-index="4">            setTimeout(() => {</span>
<span class="fragment" data-fragment-index="5">                const data = JSON.parse(body);</span>
<span class="fragment" data-fragment-index="5">                console.log(data.fact);</span>
<span class="fragment" data-fragment-index="4">            }, 1000);</span>
<span class="fragment" data-fragment-index="3">        });</span>
<span class="fragment" data-fragment-index="2">    });</span>
<span class="fragment" data-fragment-index="1">}, 5000);</span>
        </code></pre>
        <img
            src="images/callback-hell.gif"
            alt="callback-hell"
            class="fragment"
            data-fragment-index="6"
            style="position: absolute; top: 213px; left: 51px;"
        >
    </section>

    <section>
        <h3>–ó–∞–¥–∞—á–∞</h3>
        <blockquote>
            –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–∑–¥—É—Ö–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ API –ø–æ–≥–æ–¥—ã
        </blockquote>
    </section>

    <section>
        <h3>–ü—Ä–∏–º–µ—Ä</h3>
        <a href="https://api.weather.yandex.ru/v1/forecast?geoid=54&hours=false&limit=2">
            https://api.weather.yandex.ru/v1/forecast?<br>geoid=54
        </a>
    </section>

    <section>
        <h3>index.js</h3>
        <pre class="js"><code data-trim>
const getWeather = require('./getWeather');

getWeather(54, (error, temp) => {
    if (error) {
        console.error(error);
    } else {
        console.log(temp); // -3
    }
});
        </code></pre>
    </section>

    <section>
        <h3>getWeather.js</h3>
        <pre class="js size-XS"><code data-trim data-noescape>
const request = require('request');
const getWeather = (geoid, cb) => {
    <span class="fragment" data-fragment-index="1">const url = `https://.../?geoid=${geoid}`;</span>

    <span class="fragment" data-fragment-index="2">request(url, (err, res, body) => {</span>
        <span class="fragment" data-fragment-index="3">if (err) {
            cb(err);
        } </span><span class="fragment" data-fragment-index="4">else {
            const data = JSON.parse(body);

            cb(null, data.fact.temp);
        }</span>
    <span class="fragment" data-fragment-index="2">});</span>
}

module.exports = getWeather;
        </code></pre>
    </section>

    <section>
        <h3>–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è</h3>
        <pre class="js size-XS"><code data-trim data-noescape>
const request = require('request');
const getWeather = (geoid, cb) => {
    const url = `https://.../?geoid=${geoid}`;

    request(url, (err, res, body) => {
        if (err) {
            cb(err);
        } else {
            <mark>const data = JSON.parse(body);</mark>

            cb(null, data.fact.temp);
        }
    });
}

module.exports = getWeather;
        </code></pre>
    </section>

    <section>
        <pre class="html"><code data-trim>
<h1 style='color:red'>
    Error 404: Not found :-(
</h1>
        </code></pre>
    </section>

    <section>
        <h3>–ó–∞–¥–∞—á–∞</h3>
        <blockquote>
            –í—ã—á–∏—Å–ª–∏—Ç—å —Å—Ä–µ–¥–Ω—é—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–∑–¥—É—Ö–∞ –ø–æ –æ–±–ª–∞—Å—Ç–∏
            –∏—Å–ø–æ–ª—å–∑—É—è API –ø–æ–≥–æ–¥—ã
        </blockquote>
    </section>

    <section>
        <h3>index.js</h3>
        <pre class="js"><code data-trim>
const getWeather = require('./getWeather');

getWeather(54, (err, t1) => {
    getWeather(2, (err, t2) => {
        getWeather(5, (err, t3) => {
            console.log((t1 + t2 + t3) / 3);
        });
    });
});
        </code></pre>
    </section>

    <section>
        <h3>index.js</h3>
        <pre class="js"><code data-trim>
const getWeather = require('./getWeather');

console.time('time');
getWeather(54, (err, t1) => {
    getWeather(2, (err, t2) => {
        getWeather(5, (err, t3) => {
            console.log((t1 + t2 + t3) / 3);
            console.timeEnd('time'); // 691ms
        });
    });
});
        </code></pre>
    </section>

    <section>
        <h3>–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ</h3>
        <img
            src="images/getWeatherConsistently.svg"
            alt="getWeatherConsistently">
    </section>

    <section>
        <h3>–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ</h3>
        <img
            src="images/getWeatherParallel.svg"
            alt="getWeatherConsistently">
    </section>

    <section>
        <h3>index.js</h3>
        <pre class="js"><code data-trim>
const t = [];
const cb = (err, temp) => {
    t.push(temp);

    if(t.length === 3) {
        console.log((t[0] + t[1] + t[2]) / 3);
    }
}
        </code></pre>
        <pre class="js fragment"><code data-trim>
getWeather(54, cb);
getWeather(2, cb);
getWeather(5, cb);
        </code></pre>
    </section>

    <section data-background='images/async-logo_readme.jpg' data-background-size='contain'>
    </section>

    <section>
        <h3><a href="https://caolan.github.io/async/">async.js</a> </h3>
        <pre class="js"><code data-trim>
const getWeather = require('./getWeather');
const async = require('async');

async.parallel([
    cb => getWeather(54, cb),
    cb => getWeather(2, cb),
    cb => getWeather(5, cb)
], (err, t) => {
    console.log((t[0] + t[1] + t[2]) / 3);
});
        </code></pre>
    </section>

    <section>
        <h3>–ò—Ç–æ–≥–æ</h3>
        <ul>
            <li class="fragment pos">–ü—Ä–æ—Å—Ç–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è</li>
            <li class="fragment neg">–ù–µ–ª–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥</li>
            <li class="fragment neg">callback hell</li>
            <li class="fragment neg">–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è</li>
            <li class="fragment neg">–°–ª–æ–∂–Ω—ã–π –∫–æ–¥ –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç–µ–π</li>
        </ul>
    </section>

    <section data-background='images/callback-cat.gif' data-background-size='contain'>
    </section>
</section>

<section>
    <section>
        <h3>–í–æ—Ç –±—ã –≤–º–µ—Å—Ç–æ</h3>
        <pre class="js"><code data-trim>
const getWeather = require('./getWeather');

getWeather(54, (error, temp) => {
    if (error) {
        console.error(error);
    } else {
        console.log(temp);
    }
});
        </code></pre>
    </section>

    <section>
        <h3>... –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–∏—Å–∞—Ç—å</h3>
        <pre class="js"><code>
const getWeather = require('./getWeather');

getWeather(54)
    .then(temp => console.log(temp))
    .catch(error => console.error(error));
        </code></pre>
    </section>

    <section>
        <h3>... –∏–ª–∏ –¥–∞–∂–µ</h3>
        <pre class="js"><code data-trim>
const getWeather = require('./getWeather');

getWeather(54)
    .then(console.log)
    .catch(console.error);
        </code></pre>
    </section>

    <section>
        <h3>... –∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å —Ç–∞–∫</h3>
        <pre class="js size-XS"><code data-trim>
waitAllAsync([
    getWeather(54),
    getWeather(2),
    getWeather(5)
])
    .then(t => console.log((t[0] + t[1] + t[2]) / 3))
    .catch(console.error)
        </code></pre>
    </section>

    <section>
        <h2>promises</h2>
        <h1>üéâ</h1>
    </section>

    <section>
        <h2>getWeather.js</h2>
        <pre class="js size-XS"><code data-trim data-noescape>
const request = require('request');
const getWeather =
    geoid => new Promise((<span class="fragment" data-fragment-index="3">resolve</span>, <span class="fragment" data-fragment-index="4">reject</span>) => {
        <span class="fragment" data-fragment-index="1">const url = `https://.../?geoid=${geoid}`;</span>

        <span class="fragment" data-fragment-index="2">request(url, (err, res, body) => {</span>
            <span class="fragment" data-fragment-index="4">if (err) {
                reject(err);
            } </span><span class="fragment" data-fragment-index="3">else {
                const data = JSON.parse(body);

                resolve(data.fact.temp);
            }</span>
        <span class="fragment" data-fragment-index="2">});</span>
    });
module.exports = getWeather;
        </code></pre>
    </section>

    <section>
        <h3>index.js</h3>
        <pre class="js"><code data-trim data-noescape>
const getWeather = require('./getWeather');

getWeather(54)
    .then(<span class="fragment">console.log</span>, <span class="fragment">console.error</span>);
        </code></pre>
    </section>

    <section data-background='images/promise.svg' data-background-size='contain'>
    </section>

    <section>
        <h3>unresolved ‚Üí resolve</h3>
        <ul>
            <li><code>resolve</code></li>
            <li><code>reject</code></li>
            <li>–ü—Ä–æ–∏–∑–æ—à–ª–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ</li>
        </ul>
    </section>
</section>

<section>
    <section>
        <h3>–ß–µ–π–Ω–∏–Ω–≥ –ø—Ä–æ–º–∏—Å–æ–≤</h3>
    </section>

    <section>
        <h3>Promise</h3>
        <img src="images/promise_base.svg" alt="promise_base">
    </section>

    <section>
        <blockquote>
            –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ <code>.then</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ–º–∏—Å
        </blockquote>
    </section>

    <section>
        <img src="images/then.svg" alt="then">
    </section>

    <section>
        <h3>success</h3>
        <img src="images/then_resolve.svg" alt="then_resolve">
    </section>

    <section>
        <h3>error</h3>
        <img src="images/then_reject.svg" alt="then_reject">
    </section>

    <section>
        <h3>–•—ç–ª–ø–µ—Ä—ã</h3>

        <pre class="js fragment"><code data-trim>
const identity = data => data;
        </code></pre>

        <pre class="js fragment"><code data-trim>
const thrower = error => { throw error; };
        </code></pre>
    </section>

    <section>
        <pre class="js"><code data-trim data-noescape>
const getWeather = require('./getWeather');

getWeather(54)
    .then(console.log, console.error);
        </code></pre>
    </section>

    <section>
        <pre class="js"><code data-trim data-noescape>
const getWeather = require('./getWeather');

getWeather(54)
    .then(console.log, thrower)
    .then(identity, console.error);
        </code></pre>
    </section>

    <section>
        <img src="images/promise_example_simple.svg" alt="promise_example_simple">
    </section>

    <section>
        <img src="images/promise_example_advanced.svg" alt="promise_example_advanced">
    </section>

    <section>
        <h3>–ó–∞–¥–∞—á–∞</h3>
        <blockquote>
            –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –≤–æ–∑–¥—É—Ö–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ API –ø–æ–≥–æ–¥—ã
            –∏ –∑–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª.
        </blockquote>
    </section>

    <section>
        <h3>getWeather</h3>
        <pre class="js size-XS"><code data-trim data-noescape>
const request = require('request');

const getWeather =
    geoid => new Promise((resolve, reject) => {
        const url = `https://.../?geoid=${geoid}`;

        request(url, (err, res, body) => err ?
            reject(err) :
            resolve(body));
    });
        </code></pre>
    </section>

    <section>
        <pre class="js size-XS"><code data-trim data-noescape>
getWeather(54)
    <span class="fragment" data-fragment-index="1">.then(JSON.parse, thrower)</span>
    <span class="fragment" data-fragment-index="2">.then(identity, () => ({ fact: { temp: 0 } }))</span>
    <span class="fragment" data-fragment-index="3">.then(
        data => console.log(data.fact.temp),
        thrower
    );</span>
        </code></pre>
    </section>

    <section>
        <img src="images/promise_example_get_weather.svg" alt="promise_example_get_weather">
    </section>

    <section>
        <h3>saveToFile</h3>
        <pre class="js size-XXS"><code data-trim data-noescape>
const fs = require('fs');

const saveToFile =
    data => new Promise((resolve, reject) => {
        fs.writeFile('./result.json', data, err => err ?
            reject(err) :
            resolve('success'));
    });
        </code></pre>
    </section>

    <section>
        <pre class="js size-XS"><code data-trim data-noescape>
getWeather(54)
    .then(JSON.parse, thrower)
    .then(identity, () => ({ fact: { temp: 0 } }))
    <span class="fragment" data-fragment-index="2">.then(
        data => saveToFile(data.fact.temp)</span>
            <span class="fragment" data-fragment-index="3">.then(console.log, thrower)</span>
            <span class="fragment" data-fragment-index="4">.then(identity, console.error),</span>
        <span class="fragment" data-fragment-index="2">thrower
    );</span>
        </code></pre>
    </section>

    <section>
        <blockquote>
            –í <code>.then</code> –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–µ—Ä–Ω–µ—Ç –ø—Ä–æ–º–∏—Å.
            –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è –∫–æ–≥–¥–∞ –ø—Ä–æ–º–∏—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è.
        </blockquote>
    </section>

    <section>
        <pre class="js size-XS"><code data-trim data-noescape>
getWeather(54)
    .then(JSON.parse, thrower)
    .then(identity, () => ({ fact: { temp: 0 } }))
    .then(
        data => saveToFile(data.fact.temp),
        thrower
    )
    .then(console.log, thrower)
    .then(identity, console.error);
        </code></pre>
    </section>

    <section>
        <img src="images/promise_example_save_to_file.svg" alt="promise_example_save_to_file">
    </section>

    <section>
        <pre class="js size-XS"><code data-trim data-noescape>
getWeather(54)
    .then(JSON.parse, <mark>thrower</mark>)
    .then(<mark>identity</mark>, () => ({ fact: { temp: 0 } }))
    .then(
        data => saveToFile(data.fact.temp),
        <mark>thrower</mark>
    )
    .then(console.log, <mark>thrower</mark>)
    .then(<mark>identity</mark>, console.error);
        </code></pre>
    </section>

    <section>
        <pre class="js size-XS"><code data-trim data-noescape>
getWeather(54)
    .then(JSON.parse)
    .catch(() => ({ fact: { temp: 0 } }))
    .then(data => saveToFile(data.fact.temp))
    .then(console.log)
    .catch(console.error);
        </code></pre>
    </section>

    <section data-background='images/chaining.jpg' data-background-size='contain'>
    </section>
</section>

<section>
    <section>
        <h3>Promise.all</h3>
        <pre class="js size-XS"><code data-trim>
Promise.all([
    getWeather(54),
    getWeather(2),
    getWeather(5)
])
    .then(t => console.log((t[0] + t[1] + t[2]) / 3))
    .catch(console.error)
        </code></pre>
    </section>

    <section>
        <h3>Promise.resolve</h3>
        <pre class="js size-XS"><code data-trim>
Promise
    .resolve('   –£–î–ê–õ–Ø–ï–ú     –õ–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã  ')
    .then(data => data.trim())
    .then(data => data.replace(/\s+/g, ' '))
    .then(data => data.toLowerCase())
    .then(console.log);
        </code></pre>

        <pre class="js fragment"><code data-trim>
// —É–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        </code></pre>
    </section>

    <section>
        <h3>Promise.reject</h3>
        <pre class="js"><code data-trim>
Promise
    .reject('error')
    .then(identity, console.error); // "error"
        </code></pre>
    </section>

    <section>
        <h3>–ò—Ç–æ–≥–æ</h3>
        <ul>
            <li class="fragment neg">–°–ª–æ–∂–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è</li>
            <li class="fragment neg">–ë–æ–ª–µ–µ –ª–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥</li>
            <li class="fragment pos">–ò–∑–±–∞–≤–∏–ª–∏—Å—å –æ—Ç callback hell</li>
            <li class="fragment pos">–ù–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π</li>
            <li class="fragment pos">–õ–µ–≥—á–µ –ø–∏—Å–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É</li>
        </ul>
    </section>

    <section data-background='images/caniuse_promise.jpg' data-background-size='contain'>
    </section>

    <section>
        <img src="images/bluebird.png" alt="bluebird">
    </section>

    <section>
        <h3><a href="http://bluebirdjs.com/docs/api-reference.html">bluebird</a></h3>
        <pre class="js"><code data-trim>
const Promise = require('bluebird');

Promise
    .props({
        ekb: getWeather(54),
        spb: getWeather(2),
        msk: getWeather(5)
    })
    .then(({ ekb, spb, msk }) => {
        console.log((ekb + spb + msk) / 3);
    });
        </code></pre>
    </section>
</section>

<section>
    <section>
        <h3>–≠—Ç–æ—Ç –∫–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ ...</h3>
        <pre class="js"><code data-trim data-noescape>
getWeather(54)
    .then(JSON.parse)
    .catch(() => ({ fact: { temp: 0 } }))
    .then(console.log)
    .catch(console.error);
        </code></pre>
    </section>

    <section>
        <h3>... –Ω–æ —Ç–∞–∫ –ø–æ–Ω—è—Ç–Ω–µ–µ</h3>
        <pre class="js"><code data-trim data-noescape>
try {
    const body = <mark class="fragment">await</mark> getWeather(geoid);

    return JSON.parse(body);
} catch (error) {
    return { fact: { temp: 0 } };
}
        </code></pre>
    </section>

    <section>
        <blockquote>
            <code>await</code> —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ,
            —á—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–∏—Å–∞.
            –ï—Å–ª–∏ –ø—Ä–æ–º–∏—Å –∑–∞—Ä–µ–∑–æ–ª–≤–∏–ª—Å—è - –≤–µ—Ä–Ω–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç,
            –∏–Ω–∞—á–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
        </blockquote>
    </section>

    <section>
        <h2>async await</h2>
    </section>

    <section>
        <pre class="js"><code data-trim data-noescape>
const getTempData = <mark>async</mark> geoid => {
    try {
        const body = <mark>await</mark> getWeather(geoid);

        return JSON.parse(body);
    } catch (error) {
        return { fact: { temp: 0 } };
    }
}
        </code></pre>
    </section>

    <section>
        <blockquote>
            –ü—Ä–∏ –≤—ã–∑–æ–≤–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–∞–µ–º promise
        </blockquote>
    </section>

    <section>
        <img src="images/circle.jpeg" alt="circle">
    </section>

    <section>
        <pre class="js"><code data-trim>
const run = async () => {
    const data = await getTempData(54);

    return await saveToFile(data.fact.temp);
}
        </code></pre>

        <pre class="js"><code data-trim>
run()
    .then(console.log)
    .catch(console.error);
        </code></pre>
    </section>

    <section>
        <h3>–ò—Ç–æ–≥–æ</h3>
        <ul>
            <li class="fragment neg">–°–ª–æ–∂–Ω–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è</li>
            <li class="fragment pos">–õ–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥</li>
            <li class="fragment pos">–ò–∑–±–∞–≤–∏–ª–∏—Å—å –æ—Ç callback hell</li>
            <li class="fragment pos">–ù–µ—Ç –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π</li>
            <li class="fragment pos">–õ–µ–≥—á–µ –ø–∏—Å–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É</li>
        </ul>
    </section>

    <section data-background='images/caniuse_async_function.jpg' data-background-size='contain'>
    </section>
</section>

<section data-background='images/the_end.png' data-background-size='contain'>
</section>
</div></div>

<script src="js/head.min.js"></script>
<script src="js/reveal.js"></script>
<script>
    Reveal.initialize({
        controls: false,
        slideNumber: true,
        history: true,
        dependencies: [
            {
                src: 'js/highlight.js',
                async: true,
                condition: function () {
                    return Boolean(document.querySelector('pre code'));
                },
                callback: function () {
                    hljs.initHighlightingOnLoad();
                }
            }
        ]
    });
</script>

</body>
</html>
